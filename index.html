<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تحدي الذكاء الفاخر</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    font-family: 'Cairo', sans-serif;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #app {
    background: rgba(255, 255, 255, 0.05);
    padding: 30px 40px;
    border-radius: 25px;
    max-width: 600px;
    width: 100%;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
    text-align: center;
    user-select: none;
  }
  h1 {
    margin-bottom: 20px;
    font-weight: 700;
    font-size: 2.6rem;
    letter-spacing: 1.2px;
    text-shadow: 0 0 8px #00ffea;
  }
  #question {
    font-size: 1.8rem;
    margin-bottom: 30px;
    min-height: 90px;
    line-height: 1.3;
    transition: opacity 0.6s ease;
  }
  .options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }
  .option-btn {
    background: linear-gradient(145deg, #1f2937, #334155);
    border: none;
    padding: 15px 20px;
    font-size: 1.2rem;
    font-weight: 600;
    border-radius: 15px;
    color: #00ffd2;
    cursor: pointer;
    box-shadow: 0 4px 8px #00ffd2aa;
    transition: all 0.3s ease;
    user-select: none;
  }
  .option-btn:hover {
    background: linear-gradient(145deg, #00ffd2, #00b4a2);
    color: #022;
    box-shadow: 0 0 12px #00ffd2ee;
  }
  .option-btn.correct {
    background: #00ffb3;
    color: #003311;
    box-shadow: 0 0 18px #00ffb3cc;
    pointer-events: none;
  }
  .option-btn.wrong {
    background: #ff4c4c;
    color: #330000;
    box-shadow: 0 0 18px #ff4c4ccc;
    pointer-events: none;
  }
  #next-btn {
    margin-top: 35px;
    background: #00ffd2;
    color: #022;
    border: none;
    padding: 15px 35px;
    font-size: 1.3rem;
    font-weight: 700;
    border-radius: 25px;
    cursor: pointer;
    box-shadow: 0 0 15px #00ffd2cc;
    transition: background 0.4s ease;
    user-select: none;
  }
  #next-btn:hover:not(:disabled) {
    background: #00b4a2;
    color: #fff;
  }
  #next-btn:disabled {
    background: #444;
    cursor: default;
    color: #aaa;
    box-shadow: none;
  }
  #progress-bar {
    margin-top: 25px;
    height: 12px;
    background: #222;
    border-radius: 10px;
    overflow: hidden;
  }
  #progress {
    height: 100%;
    background: linear-gradient(90deg, #00ffd2, #00b4a2);
    width: 0%;
    transition: width 0.5s ease;
  }
  #score {
    margin-top: 25px;
    font-size: 1.5rem;
    font-weight: 700;
    color: #00ffd2;
    user-select: none;
  }
</style>
</head>
<body>
  <div id="app" role="main" aria-label="لعبة تحدي الذكاء">
    <h1>تحدي الذكاء الفاخر</h1>
    <div id="question" aria-live="polite" aria-atomic="true"></div>
    <div class="options" role="list"></div>
    <button id="next-btn" disabled>السؤال التالي</button>
    <div id="progress-bar" aria-label="مؤشر التقدم">
      <div id="progress"></div>
    </div>
    <div id="score" aria-live="polite"></div>
  </div>

<script>
  const questions = [
    {q: "ما هي عاصمة أستراليا؟", a: "كانبيرا", options: ["سيدني", "ملبورن", "كانبيرا", "بريسبان"]},
    {q: "من هو مكتشف قانون الجاذبية؟", a: "نيوتن", options: ["أينشتاين", "نيوتن", "غاليليو", "كبلر"]},
    {q: "ما هو أكبر كوكب في المجموعة الشمسية؟", a: "المشتري", options: ["المشتري", "زحل", "الأرض", "المريخ"]},
    {q: "كم عدد أضلاع المثلث؟", a: "3", options: ["3", "4", "5", "6"]},
    {q: "ما هو أسرع طائر في العالم؟", a: "الصقر", options: ["النعامة", "الصقر", "الحمامة", "الغراب"]},
    {q: "من هو مؤلف مسرحية 'هاملت'؟", a: "شكسبير", options: ["شكسبير", "تولستوي", "سوفوكليس", "هيمنغواي"]},
    {q: "ما هو العضو المسؤول عن ضخ الدم في الجسم؟", a: "القلب", options: ["الرئتين", "الكبد", "القلب", "الدماغ"]},
    {q: "ما هي لغة البرمجة الأكثر استخدامًا في تطوير الويب؟", a: "جافاسكريبت", options: ["جافا", "بايثون", "جافاسكريبت", "سي شارب"]},
    {q: "ما هو أطول نهر في العالم؟", a: "النيل", options: ["الأمازون", "النيل", "اليانغتسي", "الميسيسيبي"]},
    {q: "ما هو أصغر كوكب في المجموعة الشمسية؟", a: "عطارد", options: ["عطارد", "الزهرة", "المريخ", "نبتون"]},
    {q: "ما هي أصغر وحدة في الكائنات الحية؟", a: "الخلية", options: ["العضو", "الخلية", "الجزيء", "البروتين"]},
    {q: "ما هو العنصر الكيميائي الذي رمزه Au؟", a: "الذهب", options: ["الذهب", "الفضة", "النحاس", "الرصاص"]},
    {q: "في أي قارة تقع مصر؟", a: "أفريقيا", options: ["آسيا", "أفريقيا", "أوروبا", "أمريكا"]},
    {q: "ما هو العضو المسؤول عن التنفس في الإنسان؟", a: "الرئتين", options: ["القلب", "الكبد", "الرئتين", "المعدة"]},
    {q: "من هو العالم الذي طور النظرية النسبية؟", a: "أينشتاين", options: ["نيوتن", "أينشتاين", "غاليليو", "ماكسويل"]},
    {q: "ما هي وظيفة الكبد؟", a: "تنقية الدم من السموم", options: ["تنقية الدم من السموم", "تصنيع الأنسولين", "هضم الطعام", "تنظيم ضغط الدم"]},
    {q: "ما هو أسرع وسيلة نقل؟", a: "الطائرة", options: ["السيارة", "القارب", "القطار", "الطائرة"]},
    {q: "من هو مؤسس فيسبوك؟", a: "مارك زوكربيرغ", options: ["مارك زوكربيرغ", "بيل جيتس", "ستيف جوبز", "جاك ما"]},
    {q: "ما هي أصغر قارة من حيث المساحة؟", a: "أستراليا", options: ["آسيا", "أفريقيا", "أوروبا", "أستراليا"]},
    {q: "ما هو لون السماء في النهار؟", a: "أزرق", options: ["أحمر", "أزرق", "أخضر", "أصفر"]},
    {q: "كم عدد أسنان الإنسان البالغ؟", a: "32", options: ["28", "30", "32", "34"]},
    {q: "ما هو الجهاز المسؤول عن إرسال الإشارات العصبية؟", a: "الأعصاب", options: ["الدماغ", "الأعصاب", "العضلات", "القلب"]},
    {q: "ما هو معنى كلمة HTML؟", a: "لغة ترميز النص الفائق", options: ["لغة برمجة", "لغة ترميز النص الفائق", "نظام تشغيل", "قاعدة بيانات"]},
    {q: "ما هي أكبر بحيرة في العالم؟", a: "بحيرة كاسبيان", options: ["بحيرة سوبيريور", "بحيرة كاسبيان", "بحيرة فيكتوريا", "بحيرة هورون"]},
    {q: "من هو العالم الذي اخترع المصباح الكهربائي؟", a: "توماس إديسون", options: ["نيكولا تسلا", "توماس إديسون", "ألكسندر غراهام بيل", "بن فرانكلين"]},
    {q: "ما هو اسم أكبر كوكب قزم؟", a: "بلوتو", options: ["بلوتو", "إيريس", "سيريس", "هاوميا"]},
    {q: "ما هي لغة البرمجة التي تُستخدم في تطوير تطبيقات أندرويد؟", a: "جافا", options: ["جافا", "بايثون", "سي شارب", "روبي"]},
    {q: "ما هو اسم أكبر محيط؟", a: "المحيط الهادئ", options: ["المحيط الأطلسي", "المحيط الهندي", "المحيط الهادئ", "المحيط القطبي"]},
    {q: "ما هي الوحدة الأساسية للقياس في النظام الدولي؟", a: "المتر", options: ["الكيلوغرام", "الثانية", "المتر", "الأمبير"]},
    {q: "من هو مكتشف الكهرباء؟", a: "بن فرانكلين", options: ["ألكسندر جراهام بيل", "توماس إديسون", "بن فرانكلين", "نيكولا تسلا"]},
    {q: "ما هو نوع الطاقة الناتجة عن الشمس؟", a: "الطاقة الشمسية", options: ["الطاقة الحرارية", "الطاقة الشمسية", "الطاقة الكهرومغناطيسية", "الطاقة الحركية"]},
    {q: "ما هي عملة اليابان؟", a: "الين", options: ["الدولار", "اليورو", "الين", "الجنيه"]},
    {q: "ما هو أول عنصر في الجدول الدوري؟", a: "الهيدروجين", options: ["الهيدروجين", "الأكسجين", "الكربون", "النيتروجين"]},
    {q: "ما هي الدولة التي يطلق عليها بلاد الشمس المشرقة؟", a: "اليابان", options: ["الصين", "اليابان", "كوريا", "فيتنام"]},
    {q: "ما هو اسم الكوكب الأحمر؟", a: "المريخ", options: ["الزهرة", "المريخ", "زحل", "المشتري"]},
    {q: "ما هي وظيفة الرئتين؟", a: "تنفس الهواء", options: ["ضخ الدم", "تنفس الهواء", "تنظيم درجة الحرارة", "إنتاج الهرمونات"]},
    {q: "من هو مؤلف رواية 'الأبله'؟", a: "دوستويفسكي", options: ["دوستويفسكي", "تولستوي", "غوغول", "بوشكين"]},
    {q: "ما هي أكبر قارة من حيث المساحة؟", a: "آسيا", options: ["أفريقيا", "آسيا", "أوروبا", "أمريكا الشمالية"]},
    {q: "ما هو الغاز الذي نتنفسه؟", a: "الأكسجين", options: ["النيتروجين", "الأكسجين", "ثاني أكسيد الكربون", "الهيدروجين"]},
    {q: "ما هي عملة الولايات المتحدة الأمريكية؟", a: "الدولار", options: ["الدولار", "اليورو", "الجنيه الإسترليني", "الين"]},
    {q: "ما هو الجهاز المسؤول عن الهضم؟", a: "المعدة", options: ["المعدة", "الكبد", "الأمعاء", "اللسان"]},
    {q: "من هو أول رائد فضاء؟", a: "يوري غاغارين", options: ["نيل أرمسترونغ", "يوري غاغارين", "باز ألدرين", "مايكل كولينز"]},
    {q: "ما هو اسم أطول نهر في أفريقيا؟", a: "النيل", options: ["النيل", "الكونغو", "الزامبيزي", "النيجر"]},
    {q: "ما هو علم دراسة الطيور؟", a: "علم الطيور", options: ["علم الحشرات", "علم الطيور", "علم الأسماك", "علم الثدييات"]},
    {q: "ما هي أصغر وحدة قياس للبيانات؟", a: "البت", options: ["البت", "البايت", "الكيلوبايت", "الميجابايت"]},
    {q: "من هو مكتشف البنسلين؟", a: "فلكس فلير", options: ["فلكس فلير", "ألكسندر فليمنج", "لويس باستور", "إدوارد جينر"]},
    {q: "ما هو اسم أول حاسوب؟", a: "إنياك", options: ["إنياك", "يوزر", "آي بي إم", "أبل"]},
    {q: "ما هي عاصمة اليابان؟", a: "طوكيو", options: ["طوكيو", "كيوتو", "أوساكا", "ناغويا"]},
    {q: "ما هو اسم أكبر صحراء في العالم؟", a: "الصحراء الكبرى", options: ["الصحراء الكبرى", "صحراء جوبي", "صحراء كالاهاري", "صحراء أتاكاما"]},
    {q: "ما هو العنصر الذي يرمز له بـ O؟", a: "الأكسجين", options: ["الهيدروجين", "الأكسجين", "الكربون", "النيتروجين"]},
    {q: "ما هو اسم أطول جبل في العالم؟", a: "إيفرست", options: ["إيفرست", "كيلمنجارو", "مون بلان", "أكونكاجوا"]},
    {q: "ما هي لغة البرمجة التي تُستخدم لتطوير صفحات الويب؟", a: "جافاسكريبت", options: ["بايثون", "جافاسكريبت", "روبي", "سي++"]},
    {q: "ما هو اسم أكبر دولة في العالم من حيث المساحة؟", a: "روسيا", options: ["كندا", "الصين", "الولايات المتحدة", "روسيا"]},
    {q: "ما هو الكوكب الأقرب إلى الشمس؟", a: "عطارد", options: ["عطارد", "الزهرة", "الأرض", "المريخ"]},
    {q: "ما هو اسم أشهر لوحة رسمها ليوناردو دا فينشي؟", a: "الموناليزا", options: ["الصرخة", "الليلة النجمية", "الموناليزا", "الفتاة ذات القرط اللؤلؤي"]},
    {q: "ما هي وحدة قياس شدة التيار الكهربائي؟", a: "الأمبير", options: ["الفولت", "الأوم", "الأمبير", "الواط"]},
    {q: "ما هي القارة التي تحتوي على أكبر عدد من الدول؟", a: "أفريقيا", options: ["آسيا", "أفريقيا", "أوروبا", "أمريكا الجنوبية"]}
  ];

  let usedIndexes = new Set();
  let currentQuestionIndex = null;
  let score = 0;

  const questionEl = document.getElementById('question');
  const optionsEl = document.querySelector('.options');
  const nextBtn = document.getElementById('next-btn');
  const progressEl = document.getElementById('progress');
  const scoreEl = document.getElementById('score');

  function getRandomQuestionIndex() {
    if (usedIndexes.size === questions.length) return null;
    let idx;
    do {
      idx = Math.floor(Math.random() * questions.length);
    } while (usedIndexes.has(idx));
    usedIndexes.add(idx);
    return idx;
  }

  function shuffleArray(arr) {
    for (let i = arr.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i +1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function loadQuestion() {
    currentQuestionIndex = getRandomQuestionIndex();
    if (currentQuestionIndex === null) {
      // انتهت كل الأسئلة
      questionEl.textContent = '🎉 لقد أكملت كل الأسئلة! نتيجتك النهائية: ' + score + '/' + questions.length;
      optionsEl.innerHTML = '';
      nextBtn.style.display = 'none';
      return;
    }

    const q = questions[currentQuestionIndex];
    questionEl.style.opacity = 0;
    optionsEl.style.opacity = 0;
    setTimeout(() => {
      questionEl.textContent = q.q;
      optionsEl.innerHTML = '';
      let opts = [...q.options];
      shuffleArray(opts);
      opts.forEach(option => {
        const btn = document.createElement('button');
        btn.classList.add('option-btn');
        btn.textContent = option;
        btn.addEventListener('click', () => selectAnswer(btn, q.a));
        optionsEl.appendChild(btn);
      });
      questionEl.style.opacity = 1;
      optionsEl.style.opacity = 1;
      nextBtn.disabled = true;
    }, 400);

    updateProgress();
  }

  function selectAnswer(btn, correctAnswer) {
    const buttons = optionsEl.querySelectorAll('button');
    buttons.forEach(b => {
      b.disabled = true;
      b.classList.remove('correct', 'wrong');
      if (b.textContent === correctAnswer) {
        b.classList.add('correct');
      }
    });
    if (btn.textContent === correctAnswer) {
      score++;
    } else {
      btn.classList.add('wrong');
    }
    nextBtn.disabled = false;
    updateScore();
  }

  function updateProgress() {
    const progressPercent = (usedIndexes.size / questions.length) * 100;
    progressEl.style.width = progressPercent + '%';
  }

  function updateScore() {
    scoreEl.textContent = `النتيجة: ${score} نقطة`;
  }

  nextBtn.addEventListener('click', () => {
    loadQuestion();
  });

  // بدء اللعبة عند تحميل الصفحة
  loadQuestion();
</script>

</body>
</html>  

---

### تحليل سريع للمشكلة:

- الكود يبدو صحيحًا من ناحية منطقية، لكنه قد يتعطل بسبب استخدام متكرر للـ `setTimeout` أو بسبب مشاكل في DOM أو خطأ في مكان آخر.
- أهم نقطة: هل الكود قيد التشغيل في بيئة تدعم JavaScript بشكل كامل (مثلاً متصفح حديث)؟
- قد يكون التأخير بسبب أن بعض العمليات مثل تحديث الأسئلة مع `setTimeout` لا تنفذ بشكل صحيح أو هناك مشاكل في تكرار اختيار السؤال.

---

### حل عبقري بنظرة God Mode:

**ابدأ بإعادة هيكلة تدفق تحميل الأسئلة بحيث يتجنب اعتماد الوقت (setTimeout) بلا داعي، واعتمد على تحديث سلس للواجهة بدون تأخير مزعج.**

- استخدم تقنيات مثل `requestAnimationFrame` بدلاً من `setTimeout` لجعل التحولات أكثر سلاسة.
- قلل عدد مرات إعادة الرسم والتحديثات DOM.
- يمكن إضافة مؤشر تحميل أو تحريك عند التنقل بين الأسئلة ليعطي تجربة مستخدم أفضل بدل تعليق الشاشة.
- بالإضافة لذلك، يمكن تفعيل خيار "التحميل المسبق" للأسئلة القادمة في الخلفية لتقليل زمن الانتظار.

---

### كود مُحسن سريع مع إلغاء `setTimeout` والتحميل السلس:

```js
function loadQuestion() {
  currentQuestionIndex = getRandomQuestionIndex();
  if (currentQuestionIndex === null) {
    questionEl.textContent = '🎉 لقد أكملت كل الأسئلة! نتيجتك النهائية: ' + score + '/' + questions.length;
    optionsEl.innerHTML = '';
    nextBtn.style.display = 'none';
    return;
  }

  const q = questions[currentQuestionIndex];
  questionEl.style.opacity = 0;
  optionsEl.style.opacity = 0;

  // تحديث المحتوى بشكل فوري بدون تأخير
  questionEl.textContent = q.q;
  optionsEl.innerHTML = '';
  let opts = [...q.options];
  shuffleArray(opts);
  opts.forEach(option => {
    const btn = document.createElement('button');
    btn.classList.add('option-btn');
    btn.textContent = option;
    btn.addEventListener('click', () => selectAnswer(btn, q.a));
    optionsEl.appendChild(btn);
  });

  // اجعل الانتقال بصري سلس عبر requestAnimationFrame
  requestAnimationFrame(() => {
    questionEl.style.opacity = 1;
    optionsEl.style.opacity = 1;
  });

  nextBtn.disabled = true;
  updateProgress();
}
