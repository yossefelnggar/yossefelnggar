<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>🎯 تحدي ذكاء لا نهائي - عربي</title>
  <style>
    body { background: #222f3e; color: #f5f6fa; font-family: 'Cairo', sans-serif; padding: 30px; direction: rtl; text-align: center; }
    .container { max-width: 700px; margin:auto; background:#3c40c6; border-radius:15px; padding:20px; box-shadow:0 0 20px rgba(0,0,0,0.5); }
    h1 { margin-bottom:20px; font-size:2rem; }
    .question { font-size:1.4rem; margin:20px 0; min-height:60px; }
    .options { display:grid; gap:12px; }
    .options button { padding:12px; font-size:1rem; border:none;border-radius:8px; cursor:pointer; transition:transform .1s; background:#57606f; color:#f1f2f6; }
    .options button:hover { transform:scale(1.02); }
    .correct { background:#2ed573 !important; }
    .wrong { background:#ff4757 !important; }
    #status { display:flex; justify-content:space-around; margin-top:15px; }
    #status span { font-size:1rem; }
    #endBtn { margin-top:20px; padding:10px 18px; background:#ffa502; color:#2f3542; border:none; border-radius:8px; cursor:pointer; font-size:1rem; }
    #finalResult { margin-top:30px; background:#f1f2f6; color:#2f3542; border-radius:12px; padding:20px; font-size:1.1rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎯 تحدي ذكاء لا نهائي (عربي)</h1>
    <div id="quiz">
      <div class="question" id="question">جاري تحميل السؤال...</div>
      <div class="options" id="options"></div>
      <div id="status">
        <span>⏱️ الوقت: <span id="time">--</span></span>
        <span>🎯 عدد الأسئلة: <span id="count">0</span></span>
        <span>✅ صحيح: <span id="score">0</span></span>
      </div>
      <button id="endBtn" onclick="endGame()">إنهاء اللعبة</button>
    </div>
    <div id="finalResult"></div>
  </div>

  <script>
    let score=0, count=0, time=15, timer;
    let current;
    async function fetchQuestion() {
      document.getElementById('question').innerText = '...جاري التحميل';
      document.getElementById('options').innerHTML = '';
      try {
        const res = await fetch('https://opentdb.com/api.php?amount=1&type=multiple');
        const data = await res.json();
        const q = data.results[0];
        const text = decodeHTMLEntities(q.question);
        const correct = decodeHTMLEntities(q.correct_answer);
        const incorrect = q.incorrect_answers.map(a=>decodeHTMLEntities(a));
        const opts = [correct, ...incorrect].sort(() => Math.random() - .5);
        current = { question: text, options: opts, correct };
        renderQuestion();
      } catch (e) {
        console.error(e);
        document.getElementById('question').innerText = 'حدث خطأ، أعد المحاولة';
      }
    }
    function decodeHTMLEntities(text) {
      const txt = document.createElement('textarea');
      txt.innerHTML = text;
      return txt.value;
    }
    function renderQuestion() {
      document.getElementById('question').innerText = current.question;
      const optDiv = document.getElementById('options');
      current.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.innerText = opt;
        btn.onclick = () => handle(opt, btn);
        optDiv.appendChild(btn);
      });
      resetTimer();
    }
    function handle(opt, btn) {
      clearInterval(timer);
      const all = [...document.querySelectorAll('#options button')];
      all.forEach(b=>{
        b.disabled = true;
        if (b.innerText === current.correct) b.classList.add('correct');
        if (b === btn && opt !== current.correct) b.classList.add('wrong');
      });
      if (opt === current.correct) score++;
      count++;
      updateStatus();
      setTimeout(fetchQuestion, 1500);
    }
    function resetTimer() {
      clearInterval(timer);
      time = 15;
      document.getElementById('time').innerText = time;
      timer = setInterval(() => {
        time--;
        document.getElementById('time').innerText = time;
        if (time === 0) {
          clearInterval(timer);
          count++;
          updateStatus();
          revealCorrect();
          setTimeout(fetchQuestion, 1500);
        }
      }, 1000);
    }
    function revealCorrect() {
      document.querySelectorAll('#options button').forEach(b => {
        if (b.innerText === current.correct) b.classList.add('correct');
        b.disabled = true;
      });
    }
    function updateStatus() {
      document.getElementById('score').innerText = score;
      document.getElementById('count').innerText = count;
    }
    function endGame() {
      clearInterval(timer);
      document.getElementById('quiz').style.display = 'none';
      document.getElementById('finalResult').innerHTML = `
        <h2>📊 النتيجة النهائية</h2>
        <p>عدد الأسئلة: ${count}</p>
        <p>إجابات صحيحة: ${score}</p>
        <p>إجابات خاطئة: ${count - score}</p>
        <p>نسبة النجاح: <strong>${ count? Math.round(score/count*100):0 }%</strong></p>
        <button onclick="location.reload()">🔄 أعد اللعب</button>
      `;
    }
    fetchQuestion();
  </script>
</body>
</html>
